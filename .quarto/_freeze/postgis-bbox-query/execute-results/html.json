{
  "hash": "c1715316a2987e29c9664bb6fd5e35bd",
  "result": {
    "markdown": "---\ntitle: PostgreSQL GIS Query by Bounding Box\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\nlibrary(sf)\nlibrary(ggplot2)\nsource(\"R/postgis.R\")\n```\n:::\n\n\n\n# Geospatial Extent\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Geospatial Extent](postgis-bbox-query_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n# Which military sites are in the geospatial extent?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create bounding box\nbbox <- st_bbox(p202r24)\n\n# query database\ndb <- connect_postgres()\n\n# build query\nq <- query_bounding_box(bbox[1], bbox[2], bbox[3], bbox[4], tbl = \"mil_boundaries_osm\")\nq2 <- query_bounding_box(bbox[1], bbox[2], bbox[3], bbox[4])\nboundaries <- st_read(db, query = q)\nbuildings <- st_read(db, query = q2)\nDBI::dbDisconnect(db)\n\n# clip to extent\nboundaries <- boundaries[p202r24,]\nbuildings <- buildings[p202r24,]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = p202r24, fill = NA, colour = \"black\", inherit.aes = FALSE) + \n  geom_sf(data = boundaries, fill = \"red\", colour = NA, alpha = 0.2, inherit.aes = FALSE)\n```\n\n::: {.cell-output-display}\n![Boundaries](postgis-bbox-query_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = p202r24, fill = NA, colour = \"black\", inherit.aes = FALSE) + \n  geom_sf(data = buildings, fill = \"red\", colour = \"red\", alpha = 0.2, inherit.aes = FALSE)\n```\n\n::: {.cell-output-display}\n![Buildings](postgis-bbox-query_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "postgis-bbox-query_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}